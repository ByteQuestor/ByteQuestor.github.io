<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>记一次手工在欧拉上部署OpenStack | 王子阳の主页</title><meta name="author" content="王子阳"><meta name="copyright" content="王子阳"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一直对OpenStack一知半解，在欧拉上手工部署一下OpenStack，加深一下理解，这个笔记也适用于centos8">
<meta property="og:type" content="article">
<meta property="og:title" content="记一次手工在欧拉上部署OpenStack">
<meta property="og:url" content="http://example.com/2024/09/30/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%89%8B%E5%B7%A5%E5%9C%A8%E6%AC%A7%E6%8B%89%E4%B8%8A%E9%83%A8%E7%BD%B2OpenStack/index.html">
<meta property="og:site_name" content="王子阳の主页">
<meta property="og:description" content="一直对OpenStack一知半解，在欧拉上手工部署一下OpenStack，加深一下理解，这个笔记也适用于centos8">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.gitmirror.com//ByteQuestor/picture/main/openstack1.png">
<meta property="article:published_time" content="2024-09-30T21:44:37.000Z">
<meta property="article:modified_time" content="2024-11-13T03:55:15.966Z">
<meta property="article:author" content="王子阳">
<meta property="article:tag" content="OpenStack">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.gitmirror.com//ByteQuestor/picture/main/openstack1.png"><link rel="shortcut icon" href="https://raw.gitmirror.com//ByteQuestor/picture/main/myhead.png"><link rel="canonical" href="http://example.com/2024/09/30/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%89%8B%E5%B7%A5%E5%9C%A8%E6%AC%A7%E6%8B%89%E4%B8%8A%E9%83%A8%E7%BD%B2OpenStack/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.0.0-b2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        if (name && globalFn[key][name]) return
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '记一次手工在欧拉上部署OpenStack',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-11-13 03:55:15'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://raw.gitmirror.com//ByteQuestor/picture/main/myhead.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">24</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://raw.gitmirror.com//ByteQuestor/picture/main/openstack1.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">王子阳の主页</span></a><a class="nav-page-title" href="/"><span class="site-name">记一次手工在欧拉上部署OpenStack</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">记一次手工在欧拉上部署OpenStack</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-09-30T21:44:37.000Z" title="发表于 2024-09-30 21:44:37">2024-09-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-11-13T03:55:15.966Z" title="更新于 2024-11-13 03:55:15">2024-11-13</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="用到的资源"><a href="#用到的资源" class="headerlink" title="用到的资源"></a>用到的资源</h1><blockquote>
<p><code>openEuler-22.03-LTS-x86_64-dvd.iso</code></p>
<p>参考文档：</p>
<p><a target="_blank" rel="noopener" href="https://docs.openstack.org/zh_CN/">https://docs.openstack.org/zh_CN/</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.openstack.org/install-guide">https://docs.openstack.org/install-guide</a></p>
</blockquote>
<h1 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h1><h2 id="虚拟环境准备"><a href="#虚拟环境准备" class="headerlink" title="虚拟环境准备"></a>虚拟环境准备</h2><p>利用<code>VMWare</code>安装，与以往不同的是，要选<code>centos8</code>，内存推荐<code>5G</code>以上，<code>4核</code>，根据自身实际情况配置</p>
<table>
<thead>
<tr>
<th>主机</th>
<th><code>IP</code>(单网卡NAT)</th>
<th>配置</th>
</tr>
</thead>
<tbody><tr>
<td><code>controller</code></td>
<td><code>192.168.100.10</code></td>
<td><code>4v_8G_100G</code></td>
</tr>
<tr>
<td><code>compute</code></td>
<td><code>192.168.100.20</code></td>
<td><code>4V_5G_100G_50G</code></td>
</tr>
</tbody></table>
<p>网关：<code>192.168.100.2</code></p>
<p>欧拉基本上跟<code>Centos</code>一样，安装过程略，区别是<strong>不能弱密码</strong>（但是可以进去后修改为弱密码）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">passwd</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">然后输入新密码 000000</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/001.jpg" alt="修改密码"></p>
<p>然后可以建个快照</p>
<h2 id="系统环境准备"><a href="#系统环境准备" class="headerlink" title="系统环境准备"></a>系统环境准备</h2><p>本次用的系统内核为<code>5.1</code>比较新，参考文档<a target="_blank" rel="noopener" href="https://docs.openstack.org/install-guide/environment-packages-rdo.html">OpenStack packages for RHEL and CentOS — Installation Guide documentation</a></p>
<h3 id="配置网卡"><a href="#配置网卡" class="headerlink" title="配置网卡"></a>配置网卡</h3><p>留下如下配置即可：</p>
<p><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/new_1.png" alt="网卡配置"></p>
<p><strong>注意：重启网卡的命令有区别</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nmcli c reload</span><br><span class="line">nmcli c up eth0</span><br></pre></td></tr></table></figure>

<p>注意：此阶段需要能<code>ping</code>通百度表示成功</p>
<h3 id="更改主机名"><a href="#更改主机名" class="headerlink" title="更改主机名"></a>更改主机名</h3><p><strong>controller</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname controller &amp;&amp; bash</span><br></pre></td></tr></table></figure>

<p><strong>compute</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname compute &amp;&amp; bash</span><br></pre></td></tr></table></figure>



<hr>
<blockquote>
<p>完成本阶段的脚本【双节点执行，注意修改主机名的地方要改一下】</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">hostnamectl set-hostname controller &amp;&amp; bash	# 计算节点修改这里</span><br><span class="line">systemctl stop firewalld &amp;&amp; systemctl disable firewalld</span><br><span class="line">echo &quot;192.168.100.10 controller&quot; &gt;&gt; /etc/hosts</span><br><span class="line">echo &quot;192.168.100.20 compute&quot; &gt;&gt; /etc/hosts</span><br><span class="line">sed -i &quot;s/SELINUX=enforcing/SELINUX=disabled/g&quot; /etc/selinux/config; setenforce 0;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="规划"><a href="#规划" class="headerlink" title="规划"></a>规划</h1><ul>
<li><code>keystone</code></li>
<li><code>glance</code></li>
<li><code>placement</code></li>
<li><code>nova</code></li>
<li><code>neutron</code></li>
<li><code>dashboard</code></li>
<li><code>cinder</code></li>
<li><code>swift</code></li>
</ul>
<hr>
<h1 id="部署OpenStack基本环境"><a href="#部署OpenStack基本环境" class="headerlink" title="部署OpenStack基本环境"></a>部署<code>OpenStack</code>基本环境</h1><blockquote>
<p>文档内<code>Environment</code></p>
</blockquote>
<h2 id="部署时间"><a href="#部署时间" class="headerlink" title="部署时间"></a>部署时间</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y chrony vim bash-completion net-tools</span><br></pre></td></tr></table></figure>

<p>修改配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/chrony.conf</span><br></pre></td></tr></table></figure>

<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pool ntp6.aliyun.com iburst</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/002.jpg" alt="时间"></p>
<p>重启</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart chronyd</span><br><span class="line">chronyc sources -v</span><br><span class="line">date</span><br><span class="line">clock -w</span><br></pre></td></tr></table></figure>

<blockquote>
<p>完成本阶段的脚本【双节点执行】</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装时间、编辑器、补全组件、网络工具，其中补全功能需要重连生效</span></span><br><span class="line">yum install -y chrony vim bash-completion net-tools</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改配置文件，直接追加</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">compute也可以用controller做时间服务器</span></span><br><span class="line">sed -i &quot;s/pool pool.ntp.org iburst/pool ntp6.aliyun.com iburst/g&quot; /etc/chrony.conf </span><br><span class="line">echo &quot;allow allow&quot; &gt;&gt;/etc/chrony.conf </span><br><span class="line">echo &quot;local stratum 10&quot; &gt;&gt;/etc/chrony.conf</span><br><span class="line">systemctl restart chronyd</span><br><span class="line">chronyc sources -v</span><br><span class="line">clock -w # 同步时间</span><br><span class="line">date # 查看时间</span><br></pre></td></tr></table></figure>

<h2 id="安装opensatck"><a href="#安装opensatck" class="headerlink" title="安装opensatck"></a>安装opensatck</h2><p>首先需要查看一下能够安装的<code>	opensatck</code>版本，注意：<code>dnf</code>等同于<code>yum</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf list | grep openstack</span><br></pre></td></tr></table></figure>

<p>如下图：我们只能选择如下，因为没配置其他版本的源（如果要安装<code>queens</code>版就不行）</p>
<p><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/003.jpg" alt="关于yum源"></p>
<p>安装命令（本次安装T版）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install -y openstack-release-train.noarch</span><br><span class="line">ll /etc/yum.repos.d/	# 可以看到我们的仓库下面多了t版的yum源</span><br><span class="line">yum install python3-openstackclient	# 这个计算节点不用装</span><br></pre></td></tr></table></figure>

<p>出现如下算成功</p>
<p><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/004.jpg" alt="关于yum源"></p>
<hr>
<blockquote>
<p>完成本阶段的脚本【双节点执行，注意部分计算节点不用装】但是装了也没事</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">yum install -y openstack-release-train.noarch</span><br><span class="line">yum install -y python3-openstackclient	# 这个计算节点不用装</span><br></pre></td></tr></table></figure>

<h2 id="安装数据库【controller节点】"><a href="#安装数据库【controller节点】" class="headerlink" title="安装数据库【controller节点】"></a>安装数据库【controller节点】</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y mariadb mariadb-server python3-PyMySQL</span><br></pre></td></tr></table></figure>

<p>修改配置文件</p>
<p>参考文档：<a target="_blank" rel="noopener" href="https://docs.openstack.org/install-guide/environment-sql-database-rdo.html">SQL database for RHEL and CentOS — Installation Guide documentation (openstack.org)</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf.d/openstack.cnf</span><br></pre></td></tr></table></figure>

<p>只需要修改监听地址为<code>0.0.0.0</code>，其他的默认即可</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">bind-address</span> = <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"><span class="attr">default-storage-engine</span> = innodb</span><br><span class="line"><span class="attr">innodb_file_per_table</span> = <span class="literal">on</span></span><br><span class="line"><span class="attr">max_connections</span> = <span class="number">4096</span></span><br><span class="line"><span class="attr">collation-server</span> = utf8_general_ci</span><br><span class="line"><span class="attr">character-set-server</span> = utf8</span><br></pre></td></tr></table></figure>

<p>写入配置后，重启并配置数据库自启动</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable --now mariadb.service</span><br><span class="line">ss -tnl # 看到有3306表示成功</span><br></pre></td></tr></table></figure>

<hr>
<blockquote>
<p>完成本阶段的脚本【controller节点执行】</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">yum install -y mariadb mariadb-server python3-PyMySQL</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">定义文件路径</span></span><br><span class="line">CONFIG_FILE=&quot;/etc/my.cnf.d/openstack.cnf&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">写入配置内容</span></span><br><span class="line">cat &lt;&lt;EOL &gt; &quot;$CONFIG_FILE&quot;</span><br><span class="line">[mysqld]</span><br><span class="line">bind-address = 0.0.0.0</span><br><span class="line">default-storage-engine = innodb</span><br><span class="line">innodb_file_per_table = on</span><br><span class="line">max_connections = 4096</span><br><span class="line">collation-server = utf8_general_ci</span><br><span class="line">character-set-server = utf8</span><br><span class="line">EOL</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出完成信息</span></span><br><span class="line">echo &quot;配置已写入 $CONFIG_FILE&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动数据库、配置自启动</span></span><br><span class="line">systemctl enable mariadb.service</span><br><span class="line">systemctl start mariadb.service</span><br></pre></td></tr></table></figure>

<p><strong>以下仍有需要手工的部分：（初始化数据库）</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_secure_installation</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/005.jpg" alt="关于yum源"></p>
<h2 id="安装消息队列【controller节点】"><a href="#安装消息队列【controller节点】" class="headerlink" title="安装消息队列【controller节点】"></a>安装消息队列【controller节点】</h2><p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y rabbitmq-server</span><br></pre></td></tr></table></figure>

<p>启动，如果长时间卡着，直接<code>ctrl+c</code>.（看到<code>5672</code>端口表示成功）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable --now rabbitmq-server.service</span><br><span class="line">ss -tnl</span><br></pre></td></tr></table></figure>

<p>新增一个用户</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl add_user openstack 000000</span><br></pre></td></tr></table></figure>

<p>赋予读写权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl set_permissions openstack &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span><br></pre></td></tr></table></figure>

<hr>
<blockquote>
<p>完成本阶段的脚本</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">yum install -y rabbitmq-server</span><br><span class="line">systemctl enable --now rabbitmq-server.service	# 这个地方要是卡住了需要手动搞一下</span><br><span class="line">rabbitmqctl add_user openstack 000000</span><br><span class="line">rabbitmqctl set_permissions openstack &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span><br></pre></td></tr></table></figure>

<h2 id="安装缓存【controller节点】"><a href="#安装缓存【controller节点】" class="headerlink" title="安装缓存【controller节点】"></a>安装缓存【controller节点】</h2><p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y memcached python3-memcached</span><br></pre></td></tr></table></figure>

<p>修改配置文件（将监听地址设置为<code>0.0.0.0</code>)</p>
<p>默认配置文件写了本地，但是在实验中，我们不只是有这本机需要留缓存，所以直接将<code>127.0.0.1</code>修改为&#96;&#96;0.0.0.0&#96;即可</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysconfig/memcached</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">PORT</span>=<span class="string">&quot;11211&quot;</span></span><br><span class="line"><span class="attr">USER</span>=<span class="string">&quot;memcached&quot;</span></span><br><span class="line"><span class="attr">MAXCONN</span>=<span class="string">&quot;1024&quot;</span></span><br><span class="line"><span class="attr">CACHESIZE</span>=<span class="string">&quot;64&quot;</span></span><br><span class="line"><span class="attr">OPTIONS</span>=<span class="string">&quot;-l 0.0.0.0,::1&quot;</span></span><br></pre></td></tr></table></figure>

<p>启动（看到<code>11211</code>端口表示成功）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable --now memcached.service</span><br><span class="line">ss -tnl</span><br></pre></td></tr></table></figure>

<hr>
<blockquote>
<p>完成本阶段的脚本</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">yum install -y memcached python3-memcached</span><br><span class="line">sed -i &quot;s/OPTIONS=&quot;-l 127.0.0.1,::1&quot;/OPTIONS=&quot;-l 0.0.0.0,::1&quot;/g&quot; /etc/sysconfig/memcached</span><br><span class="line">systemctl enable --now memcached.service</span><br></pre></td></tr></table></figure>

<h2 id="搭建OpenStack基本环境的所有脚本"><a href="#搭建OpenStack基本环境的所有脚本" class="headerlink" title="搭建OpenStack基本环境的所有脚本"></a>搭建OpenStack基本环境的所有脚本</h2><blockquote>
<p>在数据库部分，替换手工部分的还没写，此脚本还不能用</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">环境准备</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装时间、编辑器、补全组件、网络工具，其中补全功能需要重连生效</span></span><br><span class="line">yum install -y chrony vim bash-completion net-tools</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改配置文件，直接追加</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">compute也可以用controller做时间服务器</span></span><br><span class="line">sed -i &quot;s/pool pool.ntp.org iburst/pool ntp6.aliyun.com iburst/g&quot; /etc/chrony.conf </span><br><span class="line">echo &quot;allow allow&quot; &gt;&gt;/etc/chrony.conf </span><br><span class="line">echo &quot;local stratum 10&quot; &gt;&gt;/etc/chrony.conf</span><br><span class="line">systemctl restart chronyd</span><br><span class="line">chronyc sources -v</span><br><span class="line">clock -w # 同步时间</span><br><span class="line">date # 查看时间</span><br><span class="line">yum install -y openstack-release-train.noarch</span><br><span class="line">yum install -y python3-openstackclient	# 这个计算节点不用装</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-------------- 以下部分均不用在compute节点执行 ------------------</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装数据库</span></span><br><span class="line">yum install -y mariadb mariadb-server python3-PyMySQL</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">定义文件路径</span></span><br><span class="line">CONFIG_FILE=&quot;/etc/my.cnf.d/openstack.cnf&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">写入配置内容</span></span><br><span class="line">cat &lt;&lt;EOL &gt; &quot;$CONFIG_FILE&quot;</span><br><span class="line">[mysqld]</span><br><span class="line">bind-address = 0.0.0.0</span><br><span class="line">default-storage-engine = innodb</span><br><span class="line">innodb_file_per_table = on</span><br><span class="line">max_connections = 4096</span><br><span class="line">collation-server = utf8_general_ci</span><br><span class="line">character-set-server = utf8</span><br><span class="line">EOL</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出完成信息</span></span><br><span class="line">echo &quot;配置已写入 $CONFIG_FILE&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动数据库、配置自启动</span></span><br><span class="line">systemctl enable mariadb.service</span><br><span class="line">systemctl start mariadb.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装消息队列</span></span><br><span class="line">yum install -y rabbitmq-server</span><br><span class="line">systemctl enable --now rabbitmq-server.service	# 这个地方要是卡住了需要手动搞一下</span><br><span class="line">rabbitmqctl add_user openstack 000000</span><br><span class="line">rabbitmqctl set_permissions openstack &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装缓存</span></span><br><span class="line">yum install -y memcached python3-memcached</span><br><span class="line">sed -i &quot;s/OPTIONS=&quot;-l 127.0.0.1,::1&quot;/OPTIONS=&quot;-l 0.0.0.0,::1&quot;/g&quot; /etc/sysconfig/memcached</span><br><span class="line">systemctl enable --now memcached.service</span><br></pre></td></tr></table></figure>

<h1 id="开始部署各组件"><a href="#开始部署各组件" class="headerlink" title="开始部署各组件"></a>开始部署各组件</h1><p>参考文档：<a target="_blank" rel="noopener" href="https://docs.openstack.org/install-guide/openstack-services.html">Install OpenStack services — Installation Guide documentation</a></p>
<h2 id="keystone"><a href="#keystone" class="headerlink" title="keystone"></a>keystone</h2><p>登录数据库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql</span><br></pre></td></tr></table></figure>

<p>为<code>keystone</code>创建数据库，并为<code>keystone</code>授权，注意：以往设置的<code>000000</code>，本次设置的<code>keystone123</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE keystone;</span><br><span class="line">GRANT ALL PRIVILEGES ON keystone.* TO &#x27;keystone&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;keystone123&#x27;;</span><br></pre></td></tr></table></figure>

<p>验证：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show create database keystone; # 仅作验证</span><br></pre></td></tr></table></figure>

<p>安装（<code>dnf</code>和<code>yum</code>完全等价）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y openstack-keystone httpd python3-mod_wsgi</span><br></pre></td></tr></table></figure>

<p>然后会有一个配置文件，只需要取需要的即可，先把原来的备份</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/keystone/keystone.conf&#123;,.bak&#125;</span><br></pre></td></tr></table></figure>

<p>然后从 <code>/etc/keystone/keystone.conf.bak</code> 文件中筛选出所有不为空且不以 <code>#</code> 开头的行（也就是忽略掉<strong>空行</strong>和<strong>注释行</strong>）</p>
<p>然后再去编辑就会很好看</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">grep -Ev &quot;^$|#&quot; /etc/keystone/keystone.conf.bak &gt; /etc/keystone/keystone.conf</span><br><span class="line">vim /etc/keystone/keystone.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解释</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-E 是正则表达式，v是反向匹配（不输出匹配到的内容）</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">^$：匹配空行。^ 表示行的开始，$ 表示行的结束，因此 ^$ 表示没有字符的行。</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">|：表示“或”，用于连接多个条件。</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="comment">#：匹配以 # 开头的行，这通常用于注释行。</span></span></span><br></pre></td></tr></table></figure>

<p>添加配置内容</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[database]</span></span><br><span class="line"><span class="attr">connection</span> = mysql+pymysql://keystone:keystone123@controller/keystone</span><br><span class="line"><span class="section">[token]</span></span><br><span class="line"><span class="attr">provider</span> = fernet</span><br></pre></td></tr></table></figure>

<p>同步数据库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/sh -c &quot;keystone-manage db_sync&quot; keystone</span><br></pre></td></tr></table></figure>

<p>验证方法就是看<code>keystone</code>数据库里有无新出现的表，其他的组件也是如此验证的</p>
<p>初始化密钥库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone</span><br><span class="line">keystone-manage credential_setup --keystone-user keystone --keystone-group keystone</span><br></pre></td></tr></table></figure>

<p>引导身份服务（指定密码为<code>000000</code>）即可</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">keystone-manage bootstrap --bootstrap-password 000000 \</span><br><span class="line">  --bootstrap-admin-url http://controller:5000/v3/ \</span><br><span class="line">  --bootstrap-internal-url http://controller:5000/v3/ \</span><br><span class="line">  --bootstrap-public-url http://controller:5000/v3/ \</span><br><span class="line">  --bootstrap-region-id RegionOne</span><br></pre></td></tr></table></figure>

<p>配置<code>HttpService</code>服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/httpd/conf/httpd.conf</span><br></pre></td></tr></table></figure>

<p>进入后，修改<code>97</code>行</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ServerName controller</span><br></pre></td></tr></table></figure>

<p>软连接<code>Keystone</code> 的 <code>WSGI </code>配置文件到<code>Apache HTTP</code> 服务器的配置目录</p>
<p><code>-s</code>表示软连接，软链接我们修改一个位置其他位置也会同步修改</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/share/keystone/wsgi-keystone.conf /etc/httpd/conf.d/</span><br></pre></td></tr></table></figure>

<p>启动，看到<code>5000</code>端口说明成功（如果出现权限问题，可能是<code>SELinux 策略</code>)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable --now httpd.service</span><br></pre></td></tr></table></figure>

<p>编写环境变量文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/keystone/admin-openrc.sh</span><br></pre></td></tr></table></figure>

<p>内容（修改密码为<code>000000</code>，其他的不动，也可以直接配置下面那一个）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">export OS_USERNAME=admin</span><br><span class="line">export OS_PASSWORD=000000</span><br><span class="line">export OS_PROJECT_NAME=admin</span><br><span class="line">export OS_USER_DOMAIN_NAME=Default</span><br><span class="line">export OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line">export OS_AUTH_URL=http://controller:5000/v3</span><br><span class="line">export OS_IDENTITY_API_VERSION=3</span><br></pre></td></tr></table></figure>

<p>验证有无生效（<code>export</code>输出环境变量）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">source /etc/keystone/admin-openrc.sh</span><br><span class="line">export</span><br></pre></td></tr></table></figure>

<p>创建域、项目、用户、角色</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openstack domain create --description &quot;An Example Domain&quot; example</span><br><span class="line">openstack project create --domain default --description &quot;Service Project&quot; service</span><br></pre></td></tr></table></figure>

<p>创建 <code>OpenStack</code> 客户端环境脚本(其实和之前那一步一样的，只是更详细点，可以直接配置这个)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/keystone/admin-openrc.sh</span><br></pre></td></tr></table></figure>

<p>内容</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">export OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line">export OS_USER_DOMAIN_NAME=Default</span><br><span class="line">export OS_PROJECT_NAME=admin</span><br><span class="line">export OS_USERNAME=admin</span><br><span class="line">export OS_PASSWORD=000000</span><br><span class="line">export OS_AUTH_URL=http://controller:5000/v3</span><br><span class="line">export OS_IDENTITY_API_VERSION=3</span><br><span class="line">export OS_IMAGE_API_VERSION=2</span><br></pre></td></tr></table></figure>

<p>验证（返回<code>value</code>表示成功）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack token issue</span><br></pre></td></tr></table></figure>

<p>提示：至此是没有问题的</p>
<hr>
<blockquote>
<p>本阶段脚本（暂时不能一键执行，放这里只是为了方便粘贴）</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p # 注意数据库没密码，直接回车</span><br><span class="line">CREATE DATABASE keystone;</span><br><span class="line">GRANT ALL PRIVILEGES ON keystone.* TO &#x27;keystone&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;keystone123&#x27;;</span><br><span class="line">quit</span><br><span class="line">dnf install -y openstack-keystone httpd python3-mod_wsgi</span><br><span class="line">cp /etc/keystone/keystone.conf&#123;,.bak&#125;</span><br><span class="line">grep -Ev &quot;^$|#&quot; /etc/keystone/keystone.conf.bak &gt; /etc/keystone/keystone.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">对配置文件进行一系列添加</span></span><br><span class="line">su -s /bin/sh -c &quot;keystone-manage db_sync&quot; keystone</span><br><span class="line">keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone</span><br><span class="line">keystone-manage credential_setup --keystone-user keystone --keystone-group keystone</span><br><span class="line">keystone-manage bootstrap --bootstrap-password 000000 \</span><br><span class="line">  --bootstrap-admin-url http://controller:5000/v3/ \</span><br><span class="line">  --bootstrap-internal-url http://controller:5000/v3/ \</span><br><span class="line">  --bootstrap-public-url http://controller:5000/v3/ \</span><br><span class="line">  --bootstrap-region-id RegionOne</span><br><span class="line">echo &quot;ServerName controller&quot; &gt;&gt; /etc/httpd/conf/httpd.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">定义文件路径</span></span><br><span class="line">CONFIG_FILE=&quot;/etc/keystone/admin-openrc.sh&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">写入配置内容</span></span><br><span class="line">cat &lt;&lt;EOL &gt; &quot;$CONFIG_FILE&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">export OS_USERNAME=admin</span><br><span class="line">export OS_PASSWORD=000000</span><br><span class="line">export OS_PROJECT_NAME=admin</span><br><span class="line">export OS_USER_DOMAIN_NAME=Default</span><br><span class="line">export OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line">export OS_AUTH_URL=http://controller:5000/v3</span><br><span class="line">export OS_IDENTITY_API_VERSION=3</span><br><span class="line">EOL</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">赋予执行权限</span></span><br><span class="line">chmod +x &quot;$CONFIG_FILE&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出完成信息</span></span><br><span class="line">echo &quot;配置已写入 $CONFIG_FILE&quot;</span><br><span class="line">source /etc/keystone/admin-openrc.sh</span><br><span class="line">openstack domain create --description &quot;An Example Domain&quot; example</span><br><span class="line">openstack project create --domain default --description &quot;Service Project&quot; service</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">验证一下能否获取TOKEN</span></span><br><span class="line">CONFIG_FILE=&quot;/etc/keystone/admin-openrc.sh&quot;</span><br><span class="line">cat &lt;&lt;EOL &gt; &quot;$CONFIG_FILE&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">export OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line">export OS_USER_DOMAIN_NAME=Default</span><br><span class="line">export OS_PROJECT_NAME=admin</span><br><span class="line">export OS_USERNAME=admin</span><br><span class="line">export OS_PASSWORD=000000</span><br><span class="line">export OS_AUTH_URL=http://controller:5000/v3</span><br><span class="line">export OS_IDENTITY_API_VERSION=3</span><br><span class="line">export OS_IMAGE_API_VERSION=2</span><br><span class="line">EOL</span><br><span class="line">source /etc/keystone/admin-openrc.sh</span><br><span class="line">openstack token issue</span><br></pre></td></tr></table></figure>

<h2 id="glance"><a href="#glance" class="headerlink" title="glance"></a>glance</h2><p>创建数据库并赋予权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql</span><br><span class="line">CREATE DATABASE glance;</span><br><span class="line">GRANT ALL PRIVILEGES ON glance.* TO &#x27;glance&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;glance123&#x27;;</span><br><span class="line">quit</span><br></pre></td></tr></table></figure>

<p>如果过程中重启了虚拟机，需要重新导入环境变量（也可以写入<code>~/.bashrc</code>，如果是做一次实验的话就不用了）</p>
<p>创建<code>glance</code>用户</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack user create --domain default --password glance glance # 前一个glance是密码，后一个glance是用户</span><br></pre></td></tr></table></figure>

<p>给<code>glance</code>用户和<code>service</code>项目增加管理员角色</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack role add --project service --user glance admin</span><br></pre></td></tr></table></figure>

<p>创建<code>service</code>实体</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack service create --name glance  --description &quot;OpenStack Image&quot; image</span><br></pre></td></tr></table></figure>

<p>创建镜像服务（Glance）的端点</p>
<ol>
<li><strong>public</strong>：公开的端点，允许外部用户访问镜像服务。</li>
<li><strong>internal</strong>：内部端点，仅供内部服务或项目使用。</li>
<li><strong>admin</strong>：管理端点，供管理员使用，通常具有更高的权限。</li>
</ol>
<p>这些端点使得不同角色的用户能够以不同方式访问镜像服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region RegionOne image public http://controller:9292</span><br><span class="line">openstack endpoint create --region RegionOne image internal http://controller:9292</span><br><span class="line">openstack endpoint create --region RegionOne image admin http://controller:9292</span><br></pre></td></tr></table></figure>

<p>安装<code>glance</code>安装包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y openstack-glance</span><br></pre></td></tr></table></figure>

<p>和<code>keystone</code>一样的操作，备份原来的配置文件，然后去掉没必要的进行配置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/glance/glance-api.conf&#123;,.bak&#125;</span><br><span class="line">grep -Ev &quot;^$|#&quot; /etc/glance/glance-api.conf.bak &gt; /etc/glance/glance-api.conf</span><br></pre></td></tr></table></figure>

<p>添加配置内容（注意：对应的配置必须放置在对应的块下面）</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[DEFAULT]</span></span><br><span class="line"><span class="attr">log_file</span> = /var/log/glance/glance-api.log</span><br><span class="line"></span><br><span class="line"><span class="section">[database]</span></span><br><span class="line"><span class="attr">connection</span> = mysql+pymysql://glance:glance123@controller/glance</span><br><span class="line"></span><br><span class="line"><span class="section">[glance_store]</span></span><br><span class="line"><span class="attr">stores</span> = file,http</span><br><span class="line"><span class="attr">default_store</span> = file</span><br><span class="line"><span class="attr">filesystem_store_datadir</span> = /var/lib/glance/images/</span><br><span class="line"></span><br><span class="line"><span class="section">[keystone_authtoken]</span></span><br><span class="line"><span class="attr">www_authenticate_uri</span>  = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">memcached_servers</span> = controller:<span class="number">11211</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = Default</span><br><span class="line"><span class="attr">user_domain_name</span> = Default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = glance</span><br><span class="line"><span class="attr">password</span> = glance</span><br><span class="line"></span><br><span class="line"><span class="section">[paste_deploy]</span></span><br><span class="line"><span class="attr">flavor</span> = keystone</span><br></pre></td></tr></table></figure>

<p>同步 Glance（镜像服务）的数据库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/sh -c &quot;glance-manage db_sync&quot; glance</span><br></pre></td></tr></table></figure>

<p>启动服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable --now openstack-glance-api.service</span><br></pre></td></tr></table></figure>

<p>查看端口验证（出现<code>9292</code>算成功）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss -tnl</span><br></pre></td></tr></table></figure>

<p>查看日志验证</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f /var/log/glance/glance-api.log</span><br></pre></td></tr></table></figure>

<p>服务验证（必须做）建议从浏览器下载再上传，通过任何办法上传至虚拟机</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.cirros-cloud.net/0.4.0/cirros-0.4.0-x86_64-disk.img</span><br></pre></td></tr></table></figure>

<p>创建一个镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">glance image-create --name &quot;cirros&quot; \</span><br><span class="line">--file cirros-0.4.0-x86_64-disk.img \</span><br><span class="line">--disk-format qcow2 --container-format bare \</span><br><span class="line">--visibility public</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">验证</span></span><br><span class="line">glance image-list</span><br></pre></td></tr></table></figure>

<p>注意：至此是没有任何问题</p>
<hr>
<blockquote>
<p>完成此阶段的脚本</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">比完赛再写</span><br></pre></td></tr></table></figure>

<h2 id="placement"><a href="#placement" class="headerlink" title="placement"></a>placement</h2><p>创建数据库并赋予权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql</span><br><span class="line">CREATE DATABASE placement;</span><br><span class="line">GRANT ALL PRIVILEGES ON placement.* TO &#x27;placement&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;placement123&#x27;;</span><br><span class="line">quit</span><br></pre></td></tr></table></figure>

<p>创建<code>placement</code>用户和密码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack user create --domain default --password placement placement # 前面是密码，后面是用户</span><br></pre></td></tr></table></figure>

<p>将 <code>placement</code> 用户分配给 <code>service</code> 项目，并赋予 <code>admin</code> 角色（这个是<code>scheduler</code>和<code>conductor</code>服务起不来的原因）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack role add --project service --user placement admin</span><br></pre></td></tr></table></figure>

<p>创建一个名为 <code>placement</code> 的服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack service create --name placement --description &quot;Placement API&quot; placement</span><br></pre></td></tr></table></figure>

<p>为 <strong>Placement</strong> 服务创建端点（直接复制执行即可，官方文档的）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region RegionOne placement public http://controller:8778</span><br><span class="line">openstack endpoint create --region RegionOne placement internal http://controller:8778</span><br><span class="line">openstack endpoint create --region RegionOne placement admin http://controller:8778</span><br></pre></td></tr></table></figure>

<p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y openstack-placement-api</span><br></pre></td></tr></table></figure>

<p>筛选出参数</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/placement/placement.conf&#123;,.bak&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -Ev &quot;^$|#&quot; /etc/placement/placement.conf.bak &gt; /etc/placement/placement.conf</span><br></pre></td></tr></table></figure>

<p>编辑文件：<code>vim /etc/placement/placement.conf</code></p>
<p>添加如下配置</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[api]</span></span><br><span class="line"><span class="attr">auth_strategy</span> = keystone</span><br><span class="line"></span><br><span class="line"><span class="section">[keystone_authtoken]</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span>/v3</span><br><span class="line"><span class="attr">memcached_servers</span> = controller:<span class="number">11211</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = Default</span><br><span class="line"><span class="attr">user_domain_name</span> = Default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = placement</span><br><span class="line"><span class="attr">password</span> = placement</span><br><span class="line"></span><br><span class="line"><span class="section">[placement_database]</span></span><br><span class="line"><span class="attr">connection</span> = mysql+pymysql://placement:placement123@controller/placement</span><br></pre></td></tr></table></figure>

<p>同步数据库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# su -s /bin/sh -c &quot;placement-manage db sync&quot; placement</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">报以下回显，不用管</span></span><br><span class="line">/usr/lib/python3.9/site-packages/pymysql/cursors.py:170: Warning: (1280, &quot;Name &#x27;alembic_version_pkc&#x27; ignored for PRIMARY key.&quot;)</span><br><span class="line">  result = self._query(query)</span><br></pre></td></tr></table></figure>

<p>重启<code>httpd</code>之前，需要注意<code>2.4</code>版本以上<strong>重启服务器时需要对文件进行同步</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# httpd -v</span><br><span class="line">Server version: Apache/2.4.51 (Unix)</span><br><span class="line">Server built:   May  6 2024 00:00:00</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/httpd/conf.d/00-placement-api.conf</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/006.jpg" alt="关于文件同步"></p>
<p>重启<code>httpd</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart httpd</span><br></pre></td></tr></table></figure>

<p><code>ss -tnl</code>查看出现<code>8778</code>端口表示成功</p>
<p>验证</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">placement-status upgrade check</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# placement-status upgrade check</span><br><span class="line">+----------------------------------+</span><br><span class="line">| Upgrade Check Results            |</span><br><span class="line">+----------------------------------+</span><br><span class="line">| Check: Missing Root Provider IDs |</span><br><span class="line">| Result: Success                  |</span><br><span class="line">| Details: None                    |</span><br><span class="line">+----------------------------------+</span><br><span class="line">| Check: Incomplete Consumers      |</span><br><span class="line">| Result: Success                  |</span><br><span class="line">| Details: None                    |</span><br><span class="line">+----------------------------------+</span><br></pre></td></tr></table></figure>

<p>注意：至此没有问题</p>
<hr>
<h2 id="nova"><a href="#nova" class="headerlink" title="nova"></a>nova</h2><h3 id="控制节点"><a href="#控制节点" class="headerlink" title="控制节点"></a>控制节点</h3><p>创建数据库并赋予权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql</span><br><span class="line">CREATE DATABASE nova_api;</span><br><span class="line">CREATE DATABASE nova;</span><br><span class="line">CREATE DATABASE nova_cell0;</span><br><span class="line"></span><br><span class="line">GRANT ALL PRIVILEGES ON nova_api.* TO &#x27;nova&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;nova123&#x27;;</span><br><span class="line">GRANT ALL PRIVILEGES ON nova.* TO &#x27;nova&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;nova123&#x27;;</span><br><span class="line">GRANT ALL PRIVILEGES ON nova_cell0.* TO &#x27;nova&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;nova123&#x27;;</span><br></pre></td></tr></table></figure>

<p>创建用户（很慢，稍安勿躁）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack user create --domain default --password nova nova # 前密码后用户</span><br></pre></td></tr></table></figure>

<p>赋予管理员权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack role add --project service --user nova admin</span><br></pre></td></tr></table></figure>

<p>创建服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack service create --name nova --description &quot;OpenStack Compute&quot; compute</span><br></pre></td></tr></table></figure>

<p>为服务创建<code>API</code>端点</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region RegionOne compute public http://controller:8774/v2.1</span><br><span class="line">openstack endpoint create --region RegionOne compute internal http://controller:8774/v2.1</span><br><span class="line">openstack endpoint create --region RegionOne compute admin http://controller:8774/v2.1</span><br></pre></td></tr></table></figure>

<p>安装组件</p>
<p><strong>openstack-nova-api</strong>：提供 Nova 的 REST API 接口，处理用户请求并与其他组件进行通信。</p>
<p><strong>openstack-nova-conductor</strong>：负责管理计算节点的状态和任务，协调数据库操作，确保任务的分发和执行。</p>
<p><strong>openstack-nova-novncproxy</strong>：提供 VNC 代理服务，使用户能够通过浏览器访问虚拟机的控制台，方便远程管理。</p>
<p><strong>openstack-nova-scheduler</strong>：负责选择适当的计算节点来运行实例，基于资源可用性和调度策略做出决策。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y openstack-nova-api openstack-nova-conductor openstack-nova-novncproxy openstack-nova-scheduler</span><br></pre></td></tr></table></figure>

<p>过滤参数</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/nova/nova.conf&#123;,.bak&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -Ev &quot;^$|#&quot; /etc/nova/nova.conf.bak &gt; /etc/nova/nova.conf</span><br></pre></td></tr></table></figure>

<p><code>controller</code>节点填充参数（8项）</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[DEFAULT]</span></span><br><span class="line"><span class="attr">enabled_apis</span> = osapi_compute,metadata</span><br><span class="line"><span class="attr">transport_url</span> = rabbit://openstack:<span class="number">000000</span>@controller:<span class="number">5672</span>/</span><br><span class="line"><span class="attr">my_ip</span> = <span class="number">192.168</span>.<span class="number">100.10</span>	<span class="comment"># 注意这里是本机的地址</span></span><br><span class="line"><span class="attr">use_neutron</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">firewall_driver</span> = nova.virt.firewall.NoopFirewallDriver</span><br><span class="line"><span class="attr">log_file</span> = /var/log/nova/nova.log</span><br><span class="line"></span><br><span class="line"><span class="section">[api]</span></span><br><span class="line"><span class="attr">auth_strategy</span> = keystone</span><br><span class="line"></span><br><span class="line"><span class="section">[api_database]</span></span><br><span class="line"><span class="attr">connection</span> = mysql+pymysql://nova:nova123@controller/nova_api</span><br><span class="line"></span><br><span class="line"><span class="section">[database]</span></span><br><span class="line"><span class="attr">connection</span> = mysql+pymysql://nova:nova123@controller/nova</span><br><span class="line"></span><br><span class="line"><span class="section">[glance]</span></span><br><span class="line"><span class="attr">api_servers</span> = http://controller:<span class="number">9292</span></span><br><span class="line"></span><br><span class="line"><span class="section">[keystone_authtoken]</span></span><br><span class="line"><span class="attr">www_authenticate_uri</span> = http://controller:<span class="number">5000</span>/</span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span>/</span><br><span class="line"><span class="attr">memcached_servers</span> = controller:<span class="number">11211</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = Default</span><br><span class="line"><span class="attr">user_domain_name</span> = Default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = nova</span><br><span class="line"><span class="attr">password</span> = nova</span><br><span class="line"></span><br><span class="line"><span class="section">[oslo_concurrency]</span></span><br><span class="line"><span class="attr">lock_path</span> = /var/lib/nova/tmp</span><br><span class="line"></span><br><span class="line"><span class="section">[placement]</span></span><br><span class="line"><span class="attr">region_name</span> = RegionOne</span><br><span class="line"><span class="attr">project_domain_name</span> = Default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">user_domain_name</span> = Default</span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span>/v3</span><br><span class="line"><span class="attr">username</span> = placement</span><br><span class="line"><span class="attr">password</span> = placement</span><br><span class="line"></span><br><span class="line"><span class="section">[vnc]</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">server_listen</span> = <span class="variable">$my_ip</span></span><br><span class="line"><span class="attr">server_proxyclient_address</span> = <span class="variable">$my_ip</span></span><br></pre></td></tr></table></figure>

<p><code>controller</code>节点同步数据库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/sh -c &quot;nova-manage api_db sync&quot; nova</span><br><span class="line">su -s /bin/sh -c &quot;nova-manage cell_v2 map_cell0&quot; nova</span><br><span class="line">su -s /bin/sh -c &quot;nova-manage cell_v2 create_cell --name=cell1 --verbose&quot; nova</span><br><span class="line">su -s /bin/sh -c &quot;nova-manage db sync&quot; nova</span><br><span class="line">su -s /bin/sh -c &quot;nova-manage cell_v2 list_cells&quot; nova</span><br></pre></td></tr></table></figure>

<p>启动（启动不了检查配置文件和<code>placement</code>有无漏掉的步骤）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable --now \</span><br><span class="line">    openstack-nova-api.service \</span><br><span class="line">    openstack-nova-scheduler.service \</span><br><span class="line">    openstack-nova-conductor.service \</span><br><span class="line">    openstack-nova-novncproxy.service</span><br></pre></td></tr></table></figure>

<p>方便重启</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart \</span><br><span class="line">    openstack-nova-api.service \</span><br><span class="line">    openstack-nova-scheduler.service \</span><br><span class="line">    openstack-nova-conductor.service \</span><br><span class="line">    openstack-nova-novncproxy.service</span><br></pre></td></tr></table></figure>



<p><code>vnc</code>的端口是<code>6080</code>，还有个<code>8774</code>看到就算成功（暂时不理解，这些端口代表的服务）</p>
<h3 id="计算节点"><a href="#计算节点" class="headerlink" title="计算节点"></a>计算节点</h3><p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y openstack-nova-compute</span><br></pre></td></tr></table></figure>

<p>配置（配置较多，要小心）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/nova/nova.conf&#123;,.bak&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -Ev &quot;^$|#&quot; /etc/nova/nova.conf.bak &gt; /etc/nova/nova.conf</span><br></pre></td></tr></table></figure>

<p>修改配置文件<code>vim /etc/nova/nova.conf</code></p>
<p>详细内容</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[DEFAULT]</span></span><br><span class="line"><span class="attr">enabled_apis</span> = osapi_compute,metadata</span><br><span class="line"><span class="attr">transport_url</span> = rabbit://openstack:<span class="number">000000</span>@controller</span><br><span class="line"><span class="attr">compute_driver</span>=libvirt.LibvirtDriver	<span class="comment"># 【1坑】这一行要去.bak里面找到并复制过来</span></span><br><span class="line"><span class="attr">my_ip</span> = <span class="number">192.168</span>.<span class="number">100.20</span>		<span class="comment"># 注意这里是本机的地址</span></span><br><span class="line"><span class="attr">use_neutron</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">firewall_driver</span> = nova.virt.firewall.NoopFirewallDriver</span><br><span class="line"><span class="attr">log_file</span> = /var/log/nova/nova-compute.log</span><br><span class="line"></span><br><span class="line"><span class="section">[api]</span></span><br><span class="line"><span class="attr">auth_strategy</span> = keystone</span><br><span class="line"></span><br><span class="line"><span class="section">[keystone_authtoken]</span></span><br><span class="line"><span class="attr">www_authenticate_uri</span> = http://controller:<span class="number">5000</span>/</span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span>/</span><br><span class="line"><span class="attr">memcached_servers</span> = controller:<span class="number">11211</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = Default</span><br><span class="line"><span class="attr">user_domain_name</span> = Default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = nova</span><br><span class="line"><span class="attr">password</span> = nova</span><br><span class="line"></span><br><span class="line"><span class="section">[vnc]</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">server_listen</span> = <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"><span class="attr">server_proxyclient_address</span> = <span class="variable">$my_ip</span></span><br><span class="line"><span class="attr">novncproxy_base_url</span> = http://<span class="number">192.168</span>.<span class="number">100.10</span>:<span class="number">6080</span>/vnc_auto.html</span><br><span class="line"></span><br><span class="line"><span class="section">[glance]</span></span><br><span class="line"><span class="attr">api_servers</span> = http://controller:<span class="number">9292</span></span><br><span class="line"></span><br><span class="line"><span class="section">[oslo_concurrency]</span></span><br><span class="line"><span class="attr">lock_path</span> = /var/lib/nova/tmp</span><br><span class="line"></span><br><span class="line"><span class="section">[placement]</span></span><br><span class="line"><span class="attr">region_name</span> = RegionOne</span><br><span class="line"><span class="attr">project_domain_name</span> = Default</span><br><span class="line"><span class="attr">project_name</span> = service   </span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">user_domain_name</span> = Default</span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span>/v3</span><br><span class="line"><span class="attr">username</span> = placement</span><br><span class="line"><span class="attr">password</span> = placement</span><br></pre></td></tr></table></figure>

<p>注意：在<code>centos</code>中，需要修改<code>[libvirt]</code>，但是在欧拉系统中分情况；查看虚拟机是否支持虚拟化，如果是<code>0</code>则需要配置<code>[libvirt]</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">egrep -c &#x27;(vmx|svm)&#x27; /proc/cpuinfo</span><br></pre></td></tr></table></figure>

<p>添加如下内容<code>注意：如果不显示为0则不需要配置</code></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[libvirt]</span></span><br><span class="line"><span class="attr">virt_type</span> = qemu</span><br></pre></td></tr></table></figure>

<p>重启<code>注意：</code>不可以直接起，先启动<code>libvirtd</code>，再启动<code>openstack-nova-compute</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable libvirtd.service openstack-nova-compute.service</span><br><span class="line">systemctl start libvirtd</span><br><span class="line">systemctl start libvirtd.service openstack-nova-compute.service</span><br></pre></td></tr></table></figure>

<p><code>报错</code>解决：显示没用目录，直接创建一个<code>/usr/lib/python3.9/site-packages/instances</code>，并给<code>nova</code>权限去管理</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@compute ~]# tail -f  /var/log/nova/nova-compute.log </span><br><span class="line">2024-10-02 09:26:21.603 2987 ERROR nova.compute.manager   File &quot;/usr/lib/python3.9/site-packages/nova/compute/resource_tracker.py&quot;, line 871, in update_available_resource</span><br><span class="line">2024-10-02 09:26:21.603 2987 ERROR nova.compute.manager     resources = self.driver.get_available_resource(nodename)</span><br><span class="line">2024-10-02 09:26:21.603 2987 ERROR nova.compute.manager   File &quot;/usr/lib/python3.9/site-packages/nova/virt/libvirt/driver.py&quot;, line 8025, in get_available_resource</span><br><span class="line">2024-10-02 09:26:21.603 2987 ERROR nova.compute.manager     disk_info_dict = self._get_local_gb_info()</span><br><span class="line">2024-10-02 09:26:21.603 2987 ERROR nova.compute.manager   File &quot;/usr/lib/python3.9/site-packages/nova/virt/libvirt/driver.py&quot;, line 6483, in _get_local_gb_info</span><br><span class="line">2024-10-02 09:26:21.603 2987 ERROR nova.compute.manager     info = libvirt_utils.get_fs_info(CONF.instances_path)</span><br><span class="line">2024-10-02 09:26:21.603 2987 ERROR nova.compute.manager   File &quot;/usr/lib/python3.9/site-packages/nova/virt/libvirt/utils.py&quot;, line 403, in get_fs_info</span><br><span class="line">2024-10-02 09:26:21.603 2987 ERROR nova.compute.manager     hddinfo = os.statvfs(path)</span><br><span class="line">2024-10-02 09:26:21.603 2987 ERROR nova.compute.manager FileNotFoundError: [Errno 2] No such file or directory: &#x27;/usr/lib/python3.9/site-packages/instances&#x27;</span><br><span class="line">2024-10-02 09:26:21.603 2987 ERROR nova.compute.manager </span><br></pre></td></tr></table></figure>

<p>解决问题</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir /usr/lib/python3.9/site-packages/instances</span><br><span class="line">chown -R root.nova /usr/lib/python3.9/site-packages/instances</span><br><span class="line">systemctl restart openstack-nova-compute.service</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/007.jpg" alt="报错解决"></p>
<p>此时依然有问题（没有发现计算节点的主机），虽然是之前错写了<code>192.168.100.10</code>，但是写<code>192.168.100.20</code>也会出现同样的错误</p>
<p>解决问题</p>
<p>在<code>controller</code>上查看一下，如何有哪些计算节点</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack compute service list --service nova-compute</span><br></pre></td></tr></table></figure>

<p>如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack compute service list --service nova-compute</span><br><span class="line">+----+--------------+---------+------+---------+-------+----------------------------+</span><br><span class="line">| ID | Binary       | Host    | Zone | Status  | State | Updated At                 |</span><br><span class="line">+----+--------------+---------+------+---------+-------+----------------------------+</span><br><span class="line">|  9 | nova-compute | compute | nova | enabled | up    | 2024-10-29T11:07:47.000000 |</span><br><span class="line">+----+--------------+---------+------+---------+-------+----------------------------+</span><br></pre></td></tr></table></figure>

<p>同步。主机发现【<code>controller</code>执行】</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/sh -c &quot;nova-manage cell_v2 discover_hosts --verbose&quot; nova</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/008.jpg" alt="报错解决"></p>
<p>再次重启【<code>compute</code>执行】</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart openstack-nova-compute.service</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/009.jpg" alt="报错解决"></p>
<p>验证</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack compute service list</span><br></pre></td></tr></table></figure>

<p>以下<code>up</code>表示成功</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+----+----------------+------------+----------+---------+-------+----------------------------+</span><br><span class="line">| ID | Binary         | Host       | Zone     | Status  | State | Updated At                 |</span><br><span class="line">+----+----------------+------------+----------+---------+-------+----------------------------+</span><br><span class="line">|  4 | nova-conductor | controller | internal | enabled | up    | 2024-10-02T01:40:13.000000 |</span><br><span class="line">|  7 | nova-scheduler | controller | internal | enabled | up    | 2024-10-02T01:40:15.000000 |</span><br><span class="line">| 10 | nova-compute   | compute    | nova     | enabled | up    | 2024-10-02T01:40:19.000000 |</span><br><span class="line">+----+----------------+------------+----------+---------+-------+----------------------------+</span><br></pre></td></tr></table></figure>

<p>注意：执行到此没有问题</p>
<h2 id="neutron"><a href="#neutron" class="headerlink" title="neutron"></a>neutron</h2><h3 id="控制节点-1"><a href="#控制节点-1" class="headerlink" title="控制节点"></a>控制节点</h3><p>数据库创建、授权</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql</span><br><span class="line">CREATE DATABASE neutron;</span><br><span class="line">GRANT ALL PRIVILEGES ON neutron.* TO &#x27;neutron&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;neutron123&#x27;;</span><br></pre></td></tr></table></figure>

<p>创建用户</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack user create --domain default --password neutron neutron</span><br></pre></td></tr></table></figure>

<p>给用户赋予<code>admin</code>角色</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack role add --project service --user neutron admin</span><br></pre></td></tr></table></figure>

<p>创建网络服务<code>Neutron</code>的服务条目</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack service create --name neutron --description &quot;OpenStack Networking&quot; network</span><br></pre></td></tr></table></figure>

<p>为这个服务创建三个端点（分别是：内网、公网、广域网）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region RegionOne network public http://controller:9696</span><br><span class="line">openstack endpoint create --region RegionOne network internal http://controller:9696</span><br><span class="line">openstack endpoint create --region RegionOne network admin http://controller:9696</span><br></pre></td></tr></table></figure>

<h4 id="配置-server-组件"><a href="#配置-server-组件" class="headerlink" title="配置 server 组件"></a>配置 server 组件</h4><p>安装相应的服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">yum install -y openstack-neutron openstack-neutron-ml2 openstack-neutron-openvswitch ebtables</span></span><br><span class="line">yum install -y openstack-neutron openstack-neutron-ml2 openstack-neutron-linuxbridge ebtables</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">yum install -y openstack-neutron-linuxbridge.noarch</span></span><br></pre></td></tr></table></figure>

<p>有一个报错：（后面会解决）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Couldn&#x27;t write &#x27;1&#x27; to &#x27;net/bridge/bridge-nf-call-ip6tables&#x27;, ignoring: No such file or directory</span><br><span class="line">Couldn&#x27;t write &#x27;1&#x27; to &#x27;net/bridge/bridge-nf-call-iptables&#x27;, ignoring: No such file or directory</span><br></pre></td></tr></table></figure>

<p>备份、过滤</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/neutron/neutron.conf&#123;,.bak&#125;</span><br><span class="line">grep -Ev &quot;^$|#&quot; /etc/neutron/neutron.conf.bak &gt; /etc/neutron/neutron.conf</span><br></pre></td></tr></table></figure>

<p>添加配置信息<code>vim /etc/neutron/neutron.conf</code></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[DEFAULT]</span></span><br><span class="line"><span class="attr">core_plugin</span> = ml2</span><br><span class="line"><span class="attr">service_plugins</span> = router</span><br><span class="line"><span class="attr">allow_overlapping_ips</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">transport_url</span> = rabbit://openstack:<span class="number">000000</span>@controller</span><br><span class="line"><span class="attr">auth_strategy</span> = keystone</span><br><span class="line"><span class="attr">notify_nova_on_port_status_changes</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">notify_nova_on_port_data_changes</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="section">[database]</span></span><br><span class="line"><span class="attr">connection</span> = mysql+pymysql://neutron:neutron123@controller/neutron</span><br><span class="line"></span><br><span class="line"><span class="section">[keystone_authtoken]</span></span><br><span class="line"><span class="attr">www_authenticate_uri</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">memcached_servers</span> = controller:<span class="number">11211</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = Default</span><br><span class="line"><span class="attr">user_domain_name</span> = Default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = neutron</span><br><span class="line"><span class="attr">password</span> = neutron</span><br><span class="line"></span><br><span class="line"><span class="section">[oslo_concurrency]</span></span><br><span class="line"><span class="attr">lock_path</span> = /var/lib/neutron/tmp</span><br><span class="line"></span><br><span class="line"><span class="section">[nova]</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = Default</span><br><span class="line"><span class="attr">user_domain_name</span> = Default</span><br><span class="line"><span class="attr">region_name</span> = RegionOne</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = nova</span><br><span class="line"><span class="attr">password</span> = nova</span><br></pre></td></tr></table></figure>

<h4 id="配置模块化第-2-层"><a href="#配置模块化第-2-层" class="headerlink" title="配置模块化第 2 层"></a>配置模块化第 2 层</h4><p>备份、过滤</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/neutron/plugins/ml2/ml2_conf.ini&#123;,.bak&#125;</span><br><span class="line">grep -Ev &quot;^$|#&quot; /etc/neutron/plugins/ml2/ml2_conf.ini.bak &gt; /etc/neutron/plugins/ml2/ml2_conf.ini</span><br></pre></td></tr></table></figure>

<p>添加配置信息<code>vim /etc/neutron/plugins/ml2/ml2_conf.ini</code></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[ml2]</span></span><br><span class="line"><span class="comment"># ... </span></span><br><span class="line"><span class="attr">type_drivers</span> = flat,vlan,vxlan</span><br><span class="line"><span class="attr">tenant_network_types</span> = vxlan</span><br><span class="line"><span class="attr">mechanism_drivers</span> = linuxbridge,l2population</span><br><span class="line"><span class="attr">extension_drivers</span> = port_security</span><br><span class="line"></span><br><span class="line"><span class="section">[ml2_type_flat]</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="attr">flat_networks</span> = extnal</span><br><span class="line"></span><br><span class="line"><span class="section">[ml2_type_vxlan]</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="attr">vni_ranges</span> = <span class="number">1</span>:<span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="section">[securitygroup]</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="attr">enable_ipset</span> = <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h4 id="配置-Open-vSwitch-代理"><a href="#配置-Open-vSwitch-代理" class="headerlink" title="配置 Open vSwitch 代理"></a>配置 Open vSwitch 代理</h4><p>备份、过滤</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/neutron/plugins/ml2/linuxbridge_agent.ini&#123;,.bak&#125;</span><br><span class="line">grep -Ev &quot;^$|#&quot; /etc/neutron/plugins/ml2/linuxbridge_agent.ini.bak &gt; /etc/neutron/plugins/ml2/linuxbridge_agent.ini</span><br></pre></td></tr></table></figure>

<p>添加配置信息<code>vim /etc/neutron/plugins/ml2/linuxbridge_agent.ini</code></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[linux_bridge]</span></span><br><span class="line"><span class="attr">bridge_interface_mappings</span> = extnal:eth0 <span class="comment"># 注意要和上一步定义的一样，而且还要看自己的网卡名字</span></span><br><span class="line"></span><br><span class="line"><span class="section">[vxlan]</span></span><br><span class="line"><span class="attr">enable_vxlan</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">192.168</span>.<span class="number">100.10</span></span><br><span class="line"><span class="attr">l2_population</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="section">[securitygroup]</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="attr">enable_security_group</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">firewall_driver</span> = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br></pre></td></tr></table></figure>

<p>配置内核开放（注意：手工在结尾处加上<code>EOF</code>表示结束）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tee -a /etc/sysctl.conf &lt;&lt;EOF</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br></pre></td></tr></table></figure>

<p>加载模块并使其生效</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">modprobe br_netfilter</span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>

<h4 id="配置第-3-层代理"><a href="#配置第-3-层代理" class="headerlink" title="配置第 3 层代理"></a>配置第 3 层代理</h4><p>因为就添加一条，所以就不过滤了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/neutron/l3_agent.ini</span><br></pre></td></tr></table></figure>

<p>添加内容</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[DEFAULT]</span></span><br><span class="line"><span class="attr">interface_driver</span> = linuxbridge</span><br></pre></td></tr></table></figure>

<h4 id="配置-DHCP-代理"><a href="#配置-DHCP-代理" class="headerlink" title="配置 DHCP 代理"></a>配置 DHCP 代理</h4><p>因为就添加一条，所以就不过滤了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/neutron/dhcp_agent.ini</span><br></pre></td></tr></table></figure>

<p>添加内容</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[DEFAULT]</span></span><br><span class="line"><span class="attr">interface_driver</span> = linuxbridge</span><br><span class="line"><span class="attr">dhcp_driver</span> = neutron.agent.linux.dhcp.Dnsmasq</span><br><span class="line"><span class="attr">enable_isolated_metadata</span> = <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>注意：至此，没有出现分歧现象</p>
<h4 id="配置元数据代理"><a href="#配置元数据代理" class="headerlink" title="配置元数据代理"></a>配置元数据代理</h4><p>只添加一条，无需过滤</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/neutron/metadata_agent.ini</span><br></pre></td></tr></table></figure>

<p>添加内容</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[DEFAULT]</span></span><br><span class="line"><span class="attr">nova_metadata_host</span> = controller</span><br><span class="line"><span class="attr">metadata_proxy_shared_secret</span> = wzy <span class="comment"># 自定义一个标记，要牢记，后面要用</span></span><br></pre></td></tr></table></figure>

<h4 id="配置-Compute-服务以使用-Networking-服务"><a href="#配置-Compute-服务以使用-Networking-服务" class="headerlink" title="配置 Compute 服务以使用 Networking 服务"></a>配置 Compute 服务以使用 Networking 服务</h4><p>向<code>nova</code>添加配置信息<code>vim /etc/nova/nova.conf</code></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[neutron]</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = Default</span><br><span class="line"><span class="attr">user_domain_name</span> = Default</span><br><span class="line"><span class="attr">region_name</span> = RegionOne</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = neutron</span><br><span class="line"><span class="attr">password</span> = neutron</span><br><span class="line"><span class="attr">service_metadata_proxy</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">metadata_proxy_shared_secret</span> = wzy	<span class="comment"># 注意对应</span></span><br></pre></td></tr></table></figure>

<h4 id="完成安装"><a href="#完成安装" class="headerlink" title="完成安装"></a>完成安装</h4><p><code>networking </code>服务初始化脚本需要一个指向 <code>ML2 </code>插件配置的符号链接文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini</span><br></pre></td></tr></table></figure>

<p>同步数据库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/sh -c &quot;neutron-db-manage --config-file /etc/neutron/neutron.conf \</span><br><span class="line">  --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head&quot; neutron</span><br></pre></td></tr></table></figure>

<p>重启<code>nova-api</code>服务（为了生成我们刚刚添加的<code>neutron</code>配重块）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart openstack-nova-api.service</span><br></pre></td></tr></table></figure>

<p>启动 Networking 服务并配置自启动</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable neutron-server.service \</span><br><span class="line">  neutron-linuxbridge-agent.service neutron-dhcp-agent.service \</span><br><span class="line">  neutron-metadata-agent.service neutron-l3-agent.service</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">方便重启</span></span><br><span class="line">systemctl restart neutron-server.service \</span><br><span class="line">  neutron-linuxbridge-agent.service neutron-dhcp-agent.service \</span><br><span class="line">  neutron-metadata-agent.service neutron-l3-agent.service</span><br></pre></td></tr></table></figure>

<p>报错：（但是最后成功了，不用管）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">==&gt; /var/log/neutron/metadata-agent.log &lt;==</span><br><span class="line">2024-10-29 19:53:27.330 23645 ERROR neutron.agent.metadata.agent   File &quot;/usr/lib/python3.9/site-packages/oslo_messaging/_drivers/amqpdriver.py&quot;, line 661, in _send</span><br><span class="line">2024-10-29 19:53:27.330 23645 ERROR neutron.agent.metadata.agent     result = self._waiter.wait(msg_id, timeout,</span><br><span class="line">2024-10-29 19:53:27.330 23645 ERROR neutron.agent.metadata.agent   File &quot;/usr/lib/python3.9/site-packages/oslo_messaging/_drivers/amqpdriver.py&quot;, line 551, in wait</span><br><span class="line">2024-10-29 19:53:27.330 23645 ERROR neutron.agent.metadata.agent     message = self.waiters.get(msg_id, timeout=timeout)</span><br><span class="line">2024-10-29 19:53:27.330 23645 ERROR neutron.agent.metadata.agent   File &quot;/usr/lib/python3.9/site-packages/oslo_messaging/_drivers/amqpdriver.py&quot;, line 427, in get</span><br><span class="line">2024-10-29 19:53:27.330 23645 ERROR neutron.agent.metadata.agent     raise oslo_messaging.MessagingTimeout(</span><br><span class="line">2024-10-29 19:53:27.330 23645 ERROR neutron.agent.metadata.agent oslo_messaging.exceptions.MessagingTimeout: Timed out waiting for a reply to message ID c12fb6e656654662b5d7f78231d9a2e8</span><br><span class="line">2024-10-29 19:53:27.330 23645 ERROR neutron.agent.metadata.agent </span><br><span class="line">2024-10-29 19:53:27.333 23645 WARNING oslo.service.loopingcall [-] Function &#x27;neutron.agent.metadata.agent.UnixDomainMetadataProxy._report_state&#x27; run outlasted interval by 30.08 sec</span><br><span class="line">2024-10-29 19:53:27.342 23645 INFO neutron.agent.metadata.agent [-] Successfully reported state after a previous failure.</span><br></pre></td></tr></table></figure>

<p>注意：至此没有出现分歧</p>
<h3 id="计算节点-1"><a href="#计算节点-1" class="headerlink" title="计算节点"></a>计算节点</h3><p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y openstack-neutron-linuxbridge ebtables ipset</span><br></pre></td></tr></table></figure>

<h4 id="配置通用组件"><a href="#配置通用组件" class="headerlink" title="配置通用组件"></a>配置通用组件</h4><p>备份、过滤</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/neutron/neutron.conf&#123;,.bak&#125;</span><br><span class="line">grep -Ev &quot;^$|#&quot; /etc/neutron/neutron.conf.bak &gt; /etc/neutron/neutron.conf</span><br></pre></td></tr></table></figure>

<p>添加配置信息<code>vim /etc/neutron/neutron.conf</code></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[DEFAULT]</span></span><br><span class="line"><span class="attr">transport_url</span> = rabbit://openstack:<span class="number">000000</span>@controller</span><br><span class="line"><span class="attr">auth_strategy</span> = keystone</span><br><span class="line"></span><br><span class="line"><span class="section">[keystone_authtoken]</span></span><br><span class="line"><span class="attr">www_authenticate_uri</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">memcached_servers</span> = controller:<span class="number">11211</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = default</span><br><span class="line"><span class="attr">user_domain_name</span> = default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = neutron</span><br><span class="line"><span class="attr">password</span> = neutron</span><br><span class="line"></span><br><span class="line"><span class="section">[oslo_concurrency]</span></span><br><span class="line"><span class="attr">lock_path</span> = /var/lib/neutron/tmp</span><br></pre></td></tr></table></figure>

<h4 id="配置三层代理"><a href="#配置三层代理" class="headerlink" title="配置三层代理"></a>配置三层代理</h4><p>备份、过滤</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/neutron/plugins/ml2/linuxbridge_agent.ini&#123;,.bak&#125;</span><br><span class="line">grep -Ev &quot;^$|#&quot; /etc/neutron/plugins/ml2/linuxbridge_agent.ini.bak &gt; /etc/neutron/plugins/ml2/linuxbridge_agent.ini</span><br></pre></td></tr></table></figure>

<p>添加配置信息<code>vim /etc/neutron/plugins/ml2/linuxbridge_agent.ini</code></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[linux_bridge]</span></span><br><span class="line"><span class="attr">physical_interface_mappings</span> = extnal:eth0</span><br><span class="line"></span><br><span class="line"><span class="section">[vxlan]</span></span><br><span class="line"><span class="attr">enable_vxlan</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">192.168</span>.<span class="number">100.20</span></span><br><span class="line"><span class="attr">l2_population</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="section">[securitygroup]</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="attr">enable_security_group</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">firewall_driver</span> = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br></pre></td></tr></table></figure>

<p>配置内核开放</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tee -a /etc/sysctl.conf &lt;&lt;EOF</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br></pre></td></tr></table></figure>

<p>加载模块并使其生效</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">modprobe br_netfilter</span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>

<h4 id="配置-Compute-服务以使用-Networking-服务-1"><a href="#配置-Compute-服务以使用-Networking-服务-1" class="headerlink" title="配置 Compute 服务以使用 Networking 服务"></a>配置 Compute 服务以使用 Networking 服务</h4><p>新增以下配置<code>vim /etc/nova/nova.conf</code></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[neutron]</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = Default</span><br><span class="line"><span class="attr">user_domain_name</span> = Default</span><br><span class="line"><span class="attr">region_name</span> = RegionOne</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = neutron</span><br><span class="line"><span class="attr">password</span> = neutron</span><br></pre></td></tr></table></figure>

<h4 id="完成安装-1"><a href="#完成安装-1" class="headerlink" title="完成安装"></a>完成安装</h4><p>重启<code>nova-api</code>服务，很慢</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart openstack-nova-compute.service</span><br></pre></td></tr></table></figure>

<p>注意：到这一步完全一致</p>
<p>启动<code>neutron</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable --now neutron-linuxbridge-agent.service</span><br></pre></td></tr></table></figure>

<p>验证（在<code>controller</code>节点验证）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openstack network agent list</span><br><span class="line">neutron agent-list</span><br></pre></td></tr></table></figure>

<h2 id="完美成功"><a href="#完美成功" class="headerlink" title="完美成功"></a>完美成功<br><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/new_neutron_success.png" alt="成功"></h2><hr>
<p>这些不用管</p>
<p>下图是<code>linuxbridge</code>的日志</p>
<p><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/010.jpg" alt="报错解决"></p>
<p>没用<code>down</code>或<code>false</code>表示成功</p>
<p><del>由于部署过程出现些小差错，应当是两个<code>linuxbridge-agent</code>、一个<code>neutron-13-agent</code>，一个<code>dhcp-agent</code>，一个<code>metadata-agent</code></del></p>
<hr>
<h2 id="dashboard"><a href="#dashboard" class="headerlink" title="dashboard"></a>dashboard</h2><p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y openstack-dashboard</span><br></pre></td></tr></table></figure>

<p>配置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/openstack-dashboard/local_settings</span><br></pre></td></tr></table></figure>

<p>配置内容</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">xx</span></span><br><span class="line">OPENSTACK_HOST = &quot;controller&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">xx</span></span><br><span class="line">ALLOWED_HOSTS = [&quot;*&quot;]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">取消注释</span></span><br><span class="line">CACHES = &#123;</span><br><span class="line">    &#x27;default&#x27;: &#123;</span><br><span class="line">        &#x27;BACKEND&#x27;: &#x27;django.core.cache.backends.memcached.MemcachedCache&#x27;,</span><br><span class="line">        &#x27;LOCATION&#x27;: &#x27;controller:11211&#x27;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">xx</span></span><br><span class="line">SESSION_ENGINE = &#x27;django.contrib.sessions.backends.cache&#x27;</span><br><span class="line">OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True</span><br><span class="line">OPENSTACK_API_VERSIONS = &#123;</span><br><span class="line">    &quot;identity&quot;: 3,</span><br><span class="line">    &quot;image&quot;: 2,</span><br><span class="line">    &quot;volume&quot;: 3,</span><br><span class="line">&#125;</span><br><span class="line">OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = &quot;Default&quot;</span><br><span class="line">OPENSTACK_KEYSTONE_DEFAULT_ROLE = &quot;user&quot;</span><br><span class="line">TIME_ZONE = &quot;Asia/Shanghai&quot;</span><br></pre></td></tr></table></figure>

<p>配置（这一步没啥做的，关于这个配置文件可以进一步了解）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/httpd/conf.d/openstack-dashboard.conf </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果没有下面这行需要加上</span></span><br><span class="line">WSGIApplicationGroup %&#123;GLOBAL&#125;</span><br></pre></td></tr></table></figure>

<h3 id="解决问题"><a href="#解决问题" class="headerlink" title="解决问题"></a>解决问题</h3><blockquote>
<p>直接启动，不存在问题</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart httpd.service memcached.service</span><br></pre></td></tr></table></figure>

<p>如果出现问题，一般是<code>python</code>版本问题，软连接一下即可</p>
<blockquote>
<p>访问地址（存在的问题是：登录进去后，直接跳转<code>apache</code>测试页面）</p>
<p>错误日志位置：<code>/var/log/httpd/openstack-dashboard-error_log</code></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.100.10/dashboard/auth/login/</span><br></pre></td></tr></table></figure>

<p>问题解决：修改<code>vim /etc/httpd/conf.d/openstack-dashboard.conf </code>的如下地方</p>
<p><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/013.jpg" alt="报错解决"></p>
<p><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/011.jpg" alt="报错解决"></p>
<p><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/012.jpg" alt="报错解决"></p>
<blockquote>
<p>问题（说找不到<code>/usr/share/openstack-dashboard/openstack_dashboard/conf/nova_policy.json</code>）</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f /var/log/httpd/openstack-dashboard-error_log</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/014.jpg" alt="报错解决"></p>
<p>使用<code>find</code>工具找一下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# find / -name nova_policy.json</span><br><span class="line">/usr/lib/python3.9/site-packages/openstack_auth/tests/conf/nova_policy.json</span><br><span class="line">/etc/openstack-dashboard/nova_policy.json	# &lt;-- 这个是需要的</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">其他的也都在这里</span></span><br><span class="line">[root@controller ~]# ll /etc/openstack-dashboard/</span><br><span class="line">total 92K</span><br><span class="line">-rw-r----- 1 root apache 8.4K May 17  2021 cinder_policy.json</span><br><span class="line">-rw-r----- 1 root apache 1.4K May 17  2021 glance_policy.json</span><br><span class="line">-rw-r----- 1 root apache  10K May 17  2021 keystone_policy.json</span><br><span class="line">-rw-r----- 1 root apache  13K Oct  2 14:39 local_settings</span><br><span class="line">-rw-r----- 1 root apache  13K Oct  2 14:13 local_settings.rpmsave</span><br><span class="line">-rw-r----- 1 root apache  13K May 17  2021 neutron_policy.json</span><br><span class="line">drwxr-xr-x 2 root root   4.0K Oct  2 14:35 nova_policy.d</span><br><span class="line">-rw-r----- 1 root apache  10K May 17  2021 nova_policy.json</span><br></pre></td></tr></table></figure>

<p>之所以会报错是因为找的不是存放这些文件的目录：（找的是下面这个目录，本地都没有这个目录，所以肯定会报错）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/openstack-dashboard/openstack_dashboard/conf/cinder_policy.json</span><br></pre></td></tr></table></figure>

<p>解决方法：</p>
<ul>
<li><p>拷贝过去</p>
</li>
<li><p>软链接【推荐】</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /etc/openstack-dashboard /usr/share/openstack-dashboard/openstack_dashboard/conf</span><br></pre></td></tr></table></figure>

<p>再次查看<code>/usr/share/openstack-dashboard/openstack_dashboard/conf/</code>会发现下面有东西了</p>
</li>
</ul>
<p>重启<code>httpd</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart httpd memcached</span><br></pre></td></tr></table></figure>

<p>成功解决</p>
<blockquote>
<p>问题：身份管理界面，一点就<code>Internal Server Error</code>或 &#96;Forbidden&#96;&#96;</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[Wed Oct 02 15:12:33.837776 2024] [authz_core:error] [pid 24340:tid 24518] [client 192.168.100.1:9373] AH01630: client denied by server configuration: /usr/bin/keystone-wsgi-public, referer: http://192.168.100.10/admin/metadata_defs/</span><br><span class="line">[Wed Oct 02 15:12:41.231599 2024] [authz_core:error] [pid 24340:tid 24528] [client 192.168.100.1:9373] AH01630: client denied by server configuration: /usr/bin/keystone-wsgi-public, referer: http://192.168.100.10/admin/metadata_defs/</span><br><span class="line">[Wed Oct 02 15:12:47.842971 2024] [authz_core:error] [pid 24569:tid 24619] [client 192.168.100.1:9382] AH01630: client denied by server configuration: /usr/bin/keystone-wsgi-public, referer: http://192.168.100.10/admin/metadata_defs/</span><br><span class="line">[Wed Oct 02 15:12:57.859191 2024] [authz_core:error] [pid 24341:tid 24546] [client 192.168.100.1:9386] AH01630: client denied by server configuration: /usr/bin/keystone-wsgi-public, referer: http://192.168.100.10/admin/metadata_defs/</span><br></pre></td></tr></table></figure>

<p>这两个解决方法一样</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/httpd/conf.d/openstack-dashboard.conf</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/015.jpg" alt="报错解决"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/openstack-dashboard/local_settings</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/016.jpg" alt="报错解决"></p>
<p>注意：此问题属于最开始访问页面的衍生问题，其实只需要最开始加一个<code>WEBROOT=&quot;/dashboard/&quot;</code>，然后通过此路径访问即可</p>
<p>以下是正常的</p>
<p><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/017.jpg" alt="报错解决"></p>
<blockquote>
<p>创建一个实例测一下</p>
</blockquote>
<p><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/018.jpg" alt="报错解决"></p>
<p><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/019.jpg" alt="创建网络"></p>
<p><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/020.jpg" alt="报错解决"></p>
<p><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/021.jpg" alt="报错解决"></p>
<p><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/022.jpg" alt="报错解决"></p>
<p>由于网络部分出现小问题，所以暂时无法做云主机实例</p>
<p>接下来是创建实力类型、创建实例、使用我们上传的<code>cirros</code>镜像，网络选择内网网卡</p>
<p><code>注意</code>:创建实例的时候会出现报错，没有文件夹的权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R nova.nova $文件夹</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chown -R nova.nova /usr/lib/python3.9/site-packages/</span><br><span class="line">sudo chown -R nova:nova /usr/lib/python3.9/site-packages/instances/</span><br><span class="line">sudo chmod -R 775 /usr/lib/python3.9/site-packages/instances/</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack security group rule create --protocol tcp, --port-range &lt;port_range&gt; --remote-ip &lt;ip_range&gt; &lt;new_security_group_name&gt;</span><br></pre></td></tr></table></figure>



<p>这样创建的云主机是可以用<code>shell</code>连接的，还可以上网</p>
<blockquote>
<p>这里遇到报错，一直说是网卡的问题，暂时无力解决<code>nova-compute.log</code>完整报错</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">2024-10-30 11:49:58.544 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3] </span><br><span class="line">2024-10-30 11:49:58.545 2341 INFO nova.compute.manager [req-e37fab39-0d4f-4b0f-93bc-5ce7074c01a3 c051161a8cef484ebb4911b8725bedf9 b34a554fc8ab4a14b22f6ced9981b2d5 - default default] [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3] Terminating instance</span><br><span class="line">2024-10-30 11:49:58.684 2341 INFO nova.virt.libvirt.driver [-] [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3] Instance destroyed successfully.</span><br><span class="line">2024-10-30 11:49:58.685 2341 INFO nova.virt.libvirt.driver [req-e37fab39-0d4f-4b0f-93bc-5ce7074c01a3 c051161a8cef484ebb4911b8725bedf9 b34a554fc8ab4a14b22f6ced9981b2d5 - default default] [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3] Deleting instance files /usr/lib/python3.9/site-packages/instances/d6c4fa69-ca28-4411-a11f-7d0cced9cfd3_del</span><br><span class="line">2024-10-30 11:49:58.685 2341 INFO nova.virt.libvirt.driver [req-e37fab39-0d4f-4b0f-93bc-5ce7074c01a3 c051161a8cef484ebb4911b8725bedf9 b34a554fc8ab4a14b22f6ced9981b2d5 - default default] [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3] Deletion of /usr/lib/python3.9/site-packages/instances/d6c4fa69-ca28-4411-a11f-7d0cced9cfd3_del complete</span><br><span class="line">2024-10-30 11:49:58.730 2341 INFO nova.compute.manager [req-e37fab39-0d4f-4b0f-93bc-5ce7074c01a3 c051161a8cef484ebb4911b8725bedf9 b34a554fc8ab4a14b22f6ced9981b2d5 - default default] [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3] Took 0.05 seconds to destroy the instance on the hypervisor.</span><br><span class="line">2024-10-30 11:49:58.772 2341 INFO nova.compute.manager [-] [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3] Took 0.04 seconds to deallocate network for instance.</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [req-e37fab39-0d4f-4b0f-93bc-5ce7074c01a3 c051161a8cef484ebb4911b8725bedf9 b34a554fc8ab4a14b22f6ced9981b2d5 - default default] [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3] Failed to build and run instance: nova.exception.PortBindingFailed: Binding failed for port b4704c31-3f11-4027-9ba4-47df3c1dbd2e, please check neutron logs for more information.</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3] Traceback (most recent call last):</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]   File &quot;/usr/lib/python3.9/site-packages/nova/compute/manager.py&quot;, line 2441, in _build_and_run_instance</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]     self.driver.spawn(context, instance, image_meta,</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]   File &quot;/usr/lib/python3.9/site-packages/nova/virt/libvirt/driver.py&quot;, line 3541, in spawn</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]     xml = self._get_guest_xml(context, instance, network_info,</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]   File &quot;/usr/lib/python3.9/site-packages/nova/virt/libvirt/driver.py&quot;, line 6161, in _get_guest_xml</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]     network_info_str = str(network_info)</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]   File &quot;/usr/lib/python3.9/site-packages/nova/network/model.py&quot;, line 601, in __str__</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]     return self._sync_wrapper(fn, *args, **kwargs)</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]   File &quot;/usr/lib/python3.9/site-packages/nova/network/model.py&quot;, line 584, in _sync_wrapper</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]     self.wait()</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]   File &quot;/usr/lib/python3.9/site-packages/nova/network/model.py&quot;, line 616, in wait</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]     self[:] = self._gt.wait()</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]   File &quot;/usr/lib/python3.9/site-packages/eventlet/greenthread.py&quot;, line 181, in wait</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]     return self._exit_event.wait()</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]   File &quot;/usr/lib/python3.9/site-packages/eventlet/event.py&quot;, line 125, in wait</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]     result = hub.switch()</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]   File &quot;/usr/lib/python3.9/site-packages/eventlet/hubs/hub.py&quot;, line 313, in switch</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]     return self.greenlet.switch()</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]   File &quot;/usr/lib/python3.9/site-packages/eventlet/greenthread.py&quot;, line 221, in main</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]     result = function(*args, **kwargs)</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]   File &quot;/usr/lib/python3.9/site-packages/nova/utils.py&quot;, line 675, in context_wrapper</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]     return func(*args, **kwargs)</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]   File &quot;/usr/lib/python3.9/site-packages/nova/compute/manager.py&quot;, line 1716, in _allocate_network_async</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]     six.reraise(*exc_info)</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]   File &quot;/usr/lib/python3.9/site-packages/six.py&quot;, line 719, in reraise</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]     raise value</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]   File &quot;/usr/lib/python3.9/site-packages/nova/compute/manager.py&quot;, line 1694, in _allocate_network_async</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]     nwinfo = self.network_api.allocate_for_instance(</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]   File &quot;/usr/lib/python3.9/site-packages/nova/network/neutronv2/api.py&quot;, line 1037, in allocate_for_instance</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]     created_port_ids = self._update_ports_for_instance(</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]   File &quot;/usr/lib/python3.9/site-packages/nova/network/neutronv2/api.py&quot;, line 1169, in _update_ports_for_instance</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]     vif.destroy()</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]   File &quot;/usr/lib/python3.9/site-packages/oslo_utils/excutils.py&quot;, line 220, in __exit__</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]     self.force_reraise()</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]   File &quot;/usr/lib/python3.9/site-packages/oslo_utils/excutils.py&quot;, line 196, in force_reraise</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]     six.reraise(self.type_, self.value, self.tb)</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]   File &quot;/usr/lib/python3.9/site-packages/six.py&quot;, line 719, in reraise</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]     raise value</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]   File &quot;/usr/lib/python3.9/site-packages/nova/network/neutronv2/api.py&quot;, line 1138, in _update_ports_for_instance</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]     updated_port = self._update_port(</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]   File &quot;/usr/lib/python3.9/site-packages/nova/network/neutronv2/api.py&quot;, line 513, in _update_port</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]     _ensure_no_port_binding_failure(port)</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]   File &quot;/usr/lib/python3.9/site-packages/nova/network/neutronv2/api.py&quot;, line 236, in _ensure_no_port_binding_failure</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3]     raise exception.PortBindingFailed(port_id=port[&#x27;id&#x27;])</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3] nova.exception.PortBindingFailed: Binding failed for port b4704c31-3f11-4027-9ba4-47df3c1dbd2e, please check neutron logs for more information.</span><br><span class="line">2024-10-30 11:49:58.847 2341 ERROR nova.compute.manager [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3] </span><br><span class="line">2024-10-30 11:49:59.055 2341 INFO nova.compute.manager [req-e37fab39-0d4f-4b0f-93bc-5ce7074c01a3 c051161a8cef484ebb4911b8725bedf9 b34a554fc8ab4a14b22f6ced9981b2d5 - default default] [instance: d6c4fa69-ca28-4411-a11f-7d0cced9cfd3] Took 0.04 seconds to deallocate network for instance.</span><br><span class="line">2024-10-30 11:49:59.170 2341 INFO nova.scheduler.client.report [req-e37fab39-0d4f-4b0f-93bc-5ce7074c01a3 c051161a8cef484ebb4911b8725bedf9 b34a554fc8ab4a14b22f6ced9981b2d5 - default default] Deleted allocation for instance d6c4fa69-ca28-4411-a11f-7d0cced9cfd3</span><br><span class="line">2024-10-30 11:58:47.702 2341 INFO nova.compute.manager [req-12c0bdc7-71c0-423c-beba-19d3dec722a0 - - - - -] Updating bandwidth usage cache</span><br><span class="line">2024-10-30 11:58:47.715 2341 INFO nova.compute.manager [req-12c0bdc7-71c0-423c-beba-19d3dec722a0 - - - - -] Bandwidth usage not supported by libvirt.LibvirtDriver.</span><br></pre></td></tr></table></figure>

<h1 id="小娱乐"><a href="#小娱乐" class="headerlink" title="小娱乐"></a>小娱乐</h1><p>可以改一下<code>openstack</code>的图标</p>
<blockquote>
<p><code>openstack</code>的图标都是<code>svg</code>，所以可以右击<code>logo.svg</code>，然后看一下他的像素大小（搜索<code>viewBox</code>就能看到，前两个数字代表左上角坐标，后面两个是宽和高）</p>
</blockquote>
<p>然后去<code>PS</code>设计一下，导出一个透明背景的<code>png</code>，再去<code>lnkscape</code>过一下，导出为<code>svg</code>，上传到<code>openstack</code>的图片路径替换就行了<br><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/logo.png" alt="登录界面"><br><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/OpenStackByHandImg/logo-splash.png" alt="左上角图标"></p>
<hr>
<p>先暂停，后续再补上</p>
<h2 id="cinder"><a href="#cinder" class="headerlink" title="cinder"></a>cinder</h2><h2 id="swift"><a href="#swift" class="headerlink" title="swift"></a>swift</h2></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/ByteQuestor">王子阳</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2024/09/30/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%89%8B%E5%B7%A5%E5%9C%A8%E6%AC%A7%E6%8B%89%E4%B8%8A%E9%83%A8%E7%BD%B2OpenStack/">http://example.com/2024/09/30/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%89%8B%E5%B7%A5%E5%9C%A8%E6%AC%A7%E6%8B%89%E4%B8%8A%E9%83%A8%E7%BD%B2OpenStack/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">王子阳の主页</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/OpenStack/">OpenStack</a></div><div class="post-share"><div class="social-share" data-image="https://raw.gitmirror.com//ByteQuestor/picture/main/openstack1.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://raw.gitmirror.com/ByteQuestor/picture/main/paywx.png" target="_blank"><img class="post-qr-code-img" src="https://raw.gitmirror.com/ByteQuestor/picture/main/paywx.png" alt="微信投喂"/></a><div class="post-qr-code-desc">微信投喂</div></li><li class="reward-item"><a href="https://raw.gitmirror.com/ByteQuestor/picture/main/zfbbpay.png" target="_blank"><img class="post-qr-code-img" src="https://raw.gitmirror.com/ByteQuestor/picture/main/zfbbpay.png" alt="支付宝投喂"/></a><div class="post-qr-code-desc">支付宝投喂</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="prev-post pull-left" href="/2024/10/02/%E5%9C%A8Centos7-9%E4%B8%8A%E6%89%8B%E5%B7%A5%E9%83%A8%E7%BD%B2k8s/" title="在Centos7.9上手工部署k8s"><img class="cover" src="https://raw.gitmirror.com/ByteQuestor/picture/main/k8s130.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">在Centos7.9上手工部署k8s</div></div></a><a class="next-post pull-right" href="/2024/09/29/Hexo%E9%85%8D%E5%90%88GithubAction%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/" title="Hexo配合GithubAction自动化部署个人博客"><img class="cover" src="https://raw.gitmirror.com/ByteQuestor/picture/main/GitHub-Logo.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Hexo配合GithubAction自动化部署个人博客</div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info is-center"><div class="avatar-img"><img src="https://raw.gitmirror.com//ByteQuestor/picture/main/myhead.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">王子阳</div><div class="author-info-description">天地本无全</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">24</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ByteQuestor"><i class="fab fa-github"></i><span>Github</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">一定是平时练习总是 差不多 差不多 关键时刻总是差一点</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%A8%E5%88%B0%E7%9A%84%E8%B5%84%E6%BA%90"><span class="toc-number">1.</span> <span class="toc-text">用到的资源</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">2.</span> <span class="toc-text">环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">2.1.</span> <span class="toc-text">虚拟环境准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">2.2.</span> <span class="toc-text">系统环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E7%BD%91%E5%8D%A1"><span class="toc-number">2.2.1.</span> <span class="toc-text">配置网卡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E4%B8%BB%E6%9C%BA%E5%90%8D"><span class="toc-number">2.2.2.</span> <span class="toc-text">更改主机名</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%84%E5%88%92"><span class="toc-number">3.</span> <span class="toc-text">规划</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2OpenStack%E5%9F%BA%E6%9C%AC%E7%8E%AF%E5%A2%83"><span class="toc-number">4.</span> <span class="toc-text">部署OpenStack基本环境</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E6%97%B6%E9%97%B4"><span class="toc-number">4.1.</span> <span class="toc-text">部署时间</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85opensatck"><span class="toc-number">4.2.</span> <span class="toc-text">安装opensatck</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%95%B0%E6%8D%AE%E5%BA%93%E3%80%90controller%E8%8A%82%E7%82%B9%E3%80%91"><span class="toc-number">4.3.</span> <span class="toc-text">安装数据库【controller节点】</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E3%80%90controller%E8%8A%82%E7%82%B9%E3%80%91"><span class="toc-number">4.4.</span> <span class="toc-text">安装消息队列【controller节点】</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E7%BC%93%E5%AD%98%E3%80%90controller%E8%8A%82%E7%82%B9%E3%80%91"><span class="toc-number">4.5.</span> <span class="toc-text">安装缓存【controller节点】</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%AD%E5%BB%BAOpenStack%E5%9F%BA%E6%9C%AC%E7%8E%AF%E5%A2%83%E7%9A%84%E6%89%80%E6%9C%89%E8%84%9A%E6%9C%AC"><span class="toc-number">4.6.</span> <span class="toc-text">搭建OpenStack基本环境的所有脚本</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B%E9%83%A8%E7%BD%B2%E5%90%84%E7%BB%84%E4%BB%B6"><span class="toc-number">5.</span> <span class="toc-text">开始部署各组件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#keystone"><span class="toc-number">5.1.</span> <span class="toc-text">keystone</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#glance"><span class="toc-number">5.2.</span> <span class="toc-text">glance</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#placement"><span class="toc-number">5.3.</span> <span class="toc-text">placement</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nova"><span class="toc-number">5.4.</span> <span class="toc-text">nova</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9"><span class="toc-number">5.4.1.</span> <span class="toc-text">控制节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E8%8A%82%E7%82%B9"><span class="toc-number">5.4.2.</span> <span class="toc-text">计算节点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#neutron"><span class="toc-number">5.5.</span> <span class="toc-text">neutron</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9-1"><span class="toc-number">5.5.1.</span> <span class="toc-text">控制节点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-server-%E7%BB%84%E4%BB%B6"><span class="toc-number">5.5.1.1.</span> <span class="toc-text">配置 server 组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%A8%A1%E5%9D%97%E5%8C%96%E7%AC%AC-2-%E5%B1%82"><span class="toc-number">5.5.1.2.</span> <span class="toc-text">配置模块化第 2 层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-Open-vSwitch-%E4%BB%A3%E7%90%86"><span class="toc-number">5.5.1.3.</span> <span class="toc-text">配置 Open vSwitch 代理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E7%AC%AC-3-%E5%B1%82%E4%BB%A3%E7%90%86"><span class="toc-number">5.5.1.4.</span> <span class="toc-text">配置第 3 层代理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-DHCP-%E4%BB%A3%E7%90%86"><span class="toc-number">5.5.1.5.</span> <span class="toc-text">配置 DHCP 代理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%85%83%E6%95%B0%E6%8D%AE%E4%BB%A3%E7%90%86"><span class="toc-number">5.5.1.6.</span> <span class="toc-text">配置元数据代理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-Compute-%E6%9C%8D%E5%8A%A1%E4%BB%A5%E4%BD%BF%E7%94%A8-Networking-%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.5.1.7.</span> <span class="toc-text">配置 Compute 服务以使用 Networking 服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%8C%E6%88%90%E5%AE%89%E8%A3%85"><span class="toc-number">5.5.1.8.</span> <span class="toc-text">完成安装</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E8%8A%82%E7%82%B9-1"><span class="toc-number">5.5.2.</span> <span class="toc-text">计算节点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6"><span class="toc-number">5.5.2.1.</span> <span class="toc-text">配置通用组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%B8%89%E5%B1%82%E4%BB%A3%E7%90%86"><span class="toc-number">5.5.2.2.</span> <span class="toc-text">配置三层代理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-Compute-%E6%9C%8D%E5%8A%A1%E4%BB%A5%E4%BD%BF%E7%94%A8-Networking-%E6%9C%8D%E5%8A%A1-1"><span class="toc-number">5.5.2.3.</span> <span class="toc-text">配置 Compute 服务以使用 Networking 服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%8C%E6%88%90%E5%AE%89%E8%A3%85-1"><span class="toc-number">5.5.2.4.</span> <span class="toc-text">完成安装</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E7%BE%8E%E6%88%90%E5%8A%9F"><span class="toc-number">5.6.</span> <span class="toc-text">完美成功</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dashboard"><span class="toc-number">5.7.</span> <span class="toc-text">dashboard</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98"><span class="toc-number">5.7.1.</span> <span class="toc-text">解决问题</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B0%8F%E5%A8%B1%E4%B9%90"><span class="toc-number">6.</span> <span class="toc-text">小娱乐</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#cinder"><span class="toc-number">6.1.</span> <span class="toc-text">cinder</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#swift"><span class="toc-number">6.2.</span> <span class="toc-text">swift</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/11/13/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1nginx%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/" title="记录一次nginx遇到的问题"><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/nginx/nginx.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="记录一次nginx遇到的问题"/></a><div class="content"><a class="title" href="/2024/11/13/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1nginx%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/" title="记录一次nginx遇到的问题">记录一次nginx遇到的问题</a><time datetime="2024-11-13T11:34:49.000Z" title="发表于 2024-11-13 11:34:49">2024-11-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/09/%E8%AE%B0%E5%BD%95k8s%E5%BC%80%E5%8F%91%E8%BF%90%E7%BB%B4%E7%9A%84%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/" title="记录k8s开发运维的环境准备"><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/kubernetes/k8s.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="记录k8s开发运维的环境准备"/></a><div class="content"><a class="title" href="/2024/11/09/%E8%AE%B0%E5%BD%95k8s%E5%BC%80%E5%8F%91%E8%BF%90%E7%BB%B4%E7%9A%84%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/" title="记录k8s开发运维的环境准备">记录k8s开发运维的环境准备</a><time datetime="2024-11-09T18:12:57.000Z" title="发表于 2024-11-09 18:12:57">2024-11-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/07/%E8%AE%B0%E5%BD%95%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8github%E5%88%9B%E5%BB%BArelease/" title="记录如何使用github创建release"><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/GitHub-Logo.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="记录如何使用github创建release"/></a><div class="content"><a class="title" href="/2024/11/07/%E8%AE%B0%E5%BD%95%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8github%E5%88%9B%E5%BB%BArelease/" title="记录如何使用github创建release">记录如何使用github创建release</a><time datetime="2024-11-07T09:17:38.000Z" title="发表于 2024-11-07 09:17:38">2024-11-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/03/%E8%AE%B0%E5%BD%95k8s%E5%88%A0%E9%99%A4%E6%B1%A1%E7%82%B9/" title="k8s集群删除污点"><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/kubernetes/k8s.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="k8s集群删除污点"/></a><div class="content"><a class="title" href="/2024/11/03/%E8%AE%B0%E5%BD%95k8s%E5%88%A0%E9%99%A4%E6%B1%A1%E7%82%B9/" title="k8s集群删除污点">k8s集群删除污点</a><time datetime="2024-11-03T15:14:37.000Z" title="发表于 2024-11-03 15:14:37">2024-11-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/25/%E8%AE%B0%E5%BD%95%E5%B8%B8%E7%94%A8%E7%9A%84Markdown%E8%AF%AD%E5%8F%A5/" title="记录常用的Markdown语句"><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/markdown.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="记录常用的Markdown语句"/></a><div class="content"><a class="title" href="/2024/10/25/%E8%AE%B0%E5%BD%95%E5%B8%B8%E7%94%A8%E7%9A%84Markdown%E8%AF%AD%E5%8F%A5/" title="记录常用的Markdown语句">记录常用的Markdown语句</a><time datetime="2024-10-25T17:34:17.000Z" title="发表于 2024-10-25 17:34:17">2024-10-25</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 王子阳</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.0.0-b2"></script><script src="/js/main.js?v=5.0.0-b2"></script><div class="js-pjax"></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="I,LOVE,YOU" data-fontsize="25px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>